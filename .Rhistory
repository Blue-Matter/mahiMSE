library(readxl)
library(openMSE)
library(miceadds)
library(dplyr)
library(ggplot2)
setwd("C:/GitHub/DolphinMSE")
source.all("code/Source")
source.all("../mahiMSE/R")
big_dir = "C:/Users/Admin/Dropbox/temp/Dolphin/Big_data/MRIP"
dat = process_CR_RR(dir = paste0(big_dir,"/2023/ALL_TRIP_&CATCH/SA_DOLPHIN.csv"))
big_dir = "C:/Users/tcar_/Dropbox/temp/Dolphin/Big_data/MRIP"
dat = process_CR_RR(dir = paste0(big_dir,"/2023/ALL_TRIP_&CATCH/SA_DOLPHIN.csv")) #/2024/MRIP DOLPHIN.xlsx"))
dir = paste0(big_dir,"/2023/ALL_TRIP_&CATCH/SA_DOLPHIN.csv")
d4d = read.csv(dir)
dat = data.frame(Year = d4d$YEAR, Month=d4d$month,
Mode = d4d$MODE_F,
Gear = d4d$GEAR, Area = d4d$ST,
Targ = d4d$prim1_common, Targ_alt = d4d$prim2_common,
Ret = d4d$CLAIM_UNADJ,
Rel = d4d$RELEASE_UNADJ,
Catch = d4d$tot_cat,
RR = d4d$RELEASE_UNADJ / (d4d$CLAIM_UNADJ+d4d$RELEASE_UNADJ)) #d4d$tot_cat)
head(dat)
Targ=F
plot(dat$Catch,dat$RR,pch=19,col="#99999999",xlim=c(0,60),xlab = "Catch per trip (MRIP 1981 - 2024)", ylab ="Releases per trip (MRIP 1981 - 2024)");grid(col="red",lty=2)
for(i in 1:60)lines(1:100,i/(1:100),col="blue",lty=2)
if(grepl(".csv",dir)){
d4d = read.csv(dir)
}else{
d4d = as.data.frame(read_xlsx(dir))
}
source("C:/GitHub/mahiMSE/R/bag_limit.R")
dat = process_CR_RR(dir = paste0(big_dir,"/2023/ALL_TRIP_&CATCH/SA_DOLPHIN.csv")) #/2024/MRIP DOLPHIN.xlsx"))
ggplot(dat, aes(x=Catch)) +
geom_histogram(color="black", fill="white",binwidth=1)+
geom_vline(xintercept = 10,linetype= "dashed", col = "black", size = 0.7)+
facet_wrap(~ Area,scales = "free")+xlim(0, 15)
ggplot(dat, aes(x=Catch)) +
geom_histogram(color="black", fill="white",binwidth=1)+
geom_vline(xintercept = 10,linetype= "dashed", col = "black", size = 0.7)+
facet_wrap(~ Area,scales = "free")+xlim(0, 25)
ggplot(dat, aes(x=Catch)) +
geom_histogram(color="black", fill="white",binwidth=1)+
geom_vline(xintercept = 10,linetype= "dashed", col = "black", size = 0.7)+
facet_wrap(~ Area,scales = "free")+xlim(0, 25) +
xlab("Catch per trip")+ ylab("No. MRIP records")
ggplot(dat, aes(x=Catch)) +
geom_histogram(color="black", fill="white",binwidth=1)+
geom_vline(xintercept = 10,linetype= "dashed", col = "black", size = 0.7)+
facet_wrap(~ Area,scales = "free")+xlim(0, 25) +
xlab(paste0("Catch per trip(",min(dat$Year),"-", max(dat$Year),")"))+ ylab("No. MRIP records" )
ggplot(dat, aes(x=Catch)) +
geom_histogram(color="black", fill="white",binwidth=1)+
geom_vline(xintercept = 10,linetype= "dashed", col = "black", size = 0.7)+
facet_wrap(~ Area,scales = "free")+xlim(0, 50) +
xlab(paste0("Catch per trip (",min(dat$Year),"-", max(dat$Year),")"))+ ylab("No. MRIP records" )
ggplot(dat, aes(x=Catch)) +
geom_histogram(color="black", fill="white",binwidth=1)+
geom_vline(xintercept = 10,linetype= "dashed", col = "black", size = 0.7)+
facet_wrap(~ Area,scales = "free")+xlim(0, 80) +
xlab(paste0("Catch per trip (",min(dat$Year),"-", max(dat$Year),")"))+ ylab("No. MRIP records" )
ggplot(dat, aes(x=Catch)) +
geom_histogram(color="black", fill="white",binwidth=1)+
geom_vline(xintercept = 10,linetype= "dashed", col = "black", size = 0.7)+
facet_wrap(~ Area,scales = "free")+xlim(0, 70) +
xlab(paste0("Catch per trip (",min(dat$Year),"-", max(dat$Year),")"))+ ylab("No. MRIP records" )
ggsave(
ggplot(dat, aes(x=Catch)) +
geom_histogram(color="black", fill="white",binwidth=1)+
geom_vline(xintercept = 10,linetype= "dashed", col = "black", size = 0.7)+
facet_wrap(~ Area,scales = "free")+xlim(0, 70) +
xlab(paste0("Catch per trip (",min(dat$Year),"-", max(dat$Year),")"))+ ylab("No. MRIP records" ),
"Figures/Bag_limit/CR_by_state_MRIP_2023_records.jpg",res=300, units="in",width=8.5, height=8)
?ggsave
ggplot(dat, aes(x=Catch))+
geom_histogram(color="black", fill="white",binwidth=1)+
geom_vline(xintercept = 10,linetype= "dashed", col = "black", size = 0.7)+
facet_wrap(~ Area,scales = "free")+xlim(0, 70) +
xlab(paste0("Catch per trip (",min(dat$Year),"-", max(dat$Year),")"))+ ylab("No. MRIP records" )
ggsave("Figures/Bag_limit/CR_by_state_MRIP_2023_records.jpg", res=300, units="in",width=8.5, height=8)
ggsave("Figures/Bag_limit/CR_by_state_MRIP_2023_records.jpg", dpi=300, units="in",width=8.5, height=8)
head9dat
head(dat)
totcat = sum(dat$Catch)
retcat = dat$Catch; retcat[retcat>TL] = TL
TL=54
retcat = dat$Catch; retcat[retcat>TL] = TL
sum(retcat)/totcat
RRposthoc = function(dat,TL=54){
totcat = sum(dat$Catch)
retcat = dat$Catch; retcat[retcat>TL] = TL
1-sum(retcat)/totcat
}
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
totcat = dat$Catch
retcat = dat$Catch; retcat[retcat>TL] = TL
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
ret = aggregate(retcat,by=list(dat$Year, dat$Area),sum)
tot
totcat = dat$Catch
retcat = dat$Catch; retcat[retcat>TL] = TL
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
ret = aggregate(retcat,by=list(dat$Year, dat$Area),sum)
rel = 1-ret/tot
totcat = dat$Catch
retcat = dat$Catch; retcat[retcat>TL] = TL
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
ret = aggregate(retcat,by=list(dat$Year, dat$Area),sum)
rel = 1-ret$x/tot$x
RRdat = data.frame(Year = tot$Group.1, State = tot$Group.2, RR = rel)
ggplot(RRdat, aes(x=Year, y = RR))+
geom_line(color="black")+
facet_wrap(~ State,scales = "free")
totcat = dat$Catch
retcat = dat$Catch; retcat[retcat>TL] = TL
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
ret = aggregate(retcat,by=list(dat$Year, dat$Area),sum)
rel = 1-ret$x/tot$x * 100
RRdat = data.frame(Year = tot$Group.1, State = tot$Group.2, RR = rel)
ggplot(RRdat, aes(x=Year, y = RR))+
geom_line(color="black")+
facet_wrap(~ State,scales = "free")
totcat = dat$Catch
retcat = dat$Catch; retcat[retcat>TL] = TL
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
ret = aggregate(retcat,by=list(dat$Year, dat$Area),sum)
rel = (1-ret$x/tot$x) * 100
RRdat = data.frame(Year = tot$Group.1, State = tot$Group.2, RR = rel)
ggplot(RRdat, aes(x=Year, y = RR))+
geom_line(color="black")+
facet_wrap(~ State,scales = "free")
TL=c(54,40)
RRdat = NULL
for(i in 1:length(TL))
totcat = dat$Catch
retcat = dat$Catch; retcat[retcat>TL] = TL
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
ret = aggregate(retcat,by=list(dat$Year, dat$Area),sum)
rel = (1-ret$x/tot$x) * 100
tempdat = data.frame(Year = tot$Group.1, State = tot$Group.2, TL = rep(TL[i],nrow(tot)), RR = rel)
RRdat = rbind(RRdat, tempdat)
}
RRdat = NULL
for(i in 1:length(TL)){
totcat = dat$Catch
retcat = dat$Catch; retcat[retcat>TL] = TL
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
ret = aggregate(retcat,by=list(dat$Year, dat$Area),sum)
rel = (1-ret$x/tot$x) * 100
tempdat = data.frame(Year = tot$Group.1, State = tot$Group.2, TL = rep(TL[i],nrow(tot)), RR = rel)
RRdat = rbind(RRdat, tempdat)
}
i<-1
TL=c(54,40)
RRdat = NULL
totcat = dat$Catch
retcat = dat$Catch; retcat[retcat>TL] = TL
dat$Catch
RRdat = NULL
totcat = dat$Catch
for(i in 1:length(TL)){
retcat = dat$Catch; retcat[retcat>TL[i]] = TL[i]
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
ret = aggregate(retcat,by=list(dat$Year, dat$Area),sum)
rel = (1-ret$x/tot$x) * 100
tempdat = data.frame(Year = tot$Group.1, State = tot$Group.2, TL = rep(TL[i],nrow(tot)), RR = rel)
RRdat = rbind(RRdat, tempdat)
}
ggplot(RRdat, aes(x=Year, y = RR, color = TL))+
geom_line(color="black")+
facet_wrap(~ State,scales = "free")
head(RRdat)
?aes
ggplot(RRdat, aes(x=Year, y = RR, group=TL, color = TL))+
geom_line(color="black")+
facet_wrap(~ State,scales = "free")
ggplot(RRdat, aes(x=Year, y = RR, group=TL))+
geom_line(color="black")+
facet_wrap(~ State,scales = "free")
ggplot(RRdat, aes(x=Year, y = RR, group=TL,colour=TL))+
geom_line(color="black")+
facet_wrap(~ State,scales = "free")
ggplot(RRdat, aes(x=Year, y = RR, group=TL,colour=TL))+
geom_line()+
facet_wrap(~ State)
RRdat$TL = as.factor(RRdat$TL)
ggplot(RRdat, aes(x=Year, y = RR, group=TL,colour=TL))+
geom_line()+
facet_wrap(~ State)
TL=c(54,40, 35)
RRdat = NULL
totcat = dat$Catch
for(i in 1:length(TL)){
retcat = dat$Catch; retcat[retcat>TL[i]] = TL[i]
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
ret = aggregate(retcat,by=list(dat$Year, dat$Area),sum)
rel = (1-ret$x/tot$x) * 100
tempdat = data.frame(Year = tot$Group.1, State = tot$Group.2, TripLim = rep(TL[i],nrow(tot)), RR = rel)
RRdat = rbind(RRdat, tempdat)
}
RRdat$TL = as.factor(RRdat$TL)
RRdat = NULL
totcat = dat$Catch
for(i in 1:length(TL)){
retcat = dat$Catch; retcat[retcat>TL[i]] = TL[i]
tot = aggregate(totcat,by=list(dat$Year, dat$Area),sum)
ret = aggregate(retcat,by=list(dat$Year, dat$Area),sum)
rel = (1-ret$x/tot$x) * 100
tempdat = data.frame(Year = tot$Group.1, State = tot$Group.2, TripLim = rep(TL[i],nrow(tot)), RR = rel)
RRdat = rbind(RRdat, tempdat)
}
RRdat$TripLim = as.factor(RRdat$TripLim)
ggplot(RRdat, aes(x=Year, y = RR, group=TripLim,colour=TripLim))+
geom_line()+ facet_wrap(~ State)+
ylab("Predicted Release Rate (%)")
source("C:/GitHub/mahiMSE/R/bag_limit.R")
RRposthoc(dat)
ggsave("Figures/Bag_limit/predRR_by_state_MRIP_2023_records.jpg", dpi=300, units="in",width=8.5, height=8)
source("C:/GitHub/mahiMSE/R/bag_limit.R")
devtools::document()
install.packages("devtools")
devtools::document()
